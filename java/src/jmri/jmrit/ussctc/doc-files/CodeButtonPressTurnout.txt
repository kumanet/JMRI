@startuml
participant Layout
participant CodeButton
participant CodeLine
participant Station
participant TurnoutSection
participant Locking

Layout o-> CodeButton: Button Pressed\nSensor ACTIVE
activate CodeButton
CodeButton ->o Layout : Code Indicator\nON

CodeButton -> Station : codeSendRequest()
activate Station
Station -> TurnoutSection : codeSendStart()
activate TurnoutSection
TurnoutSection ->o Layout : TO Indicators\nOFF
deactivate TurnoutSection

Station -> TurnoutSection : codeSendOK()
activate TurnoutSection
TurnoutSection -> Locking : opOK()
activate Locking
note over Locking : Checks multiple modes, OK
deactivate Locking
deactivate TurnoutSection

note over Station : If Locking not OK,\nend here by telling\nCodeButton it's over
Station -> CodeLine : requestSendCode()
activate CodeLine
note over CodeLine : Might be delay here\nif already running
CodeLine ->o Layout : Code sequence\nSTART
deactivate CodeLine
deactivate Station
deactivate CodeButton

note over Layout : hardware or software\n          delay

Layout o-> CodeLine: Code sequence\nCOMPLETE
activate CodeLine
CodeLine -> Station : codeValueDelivered()
activate Station
Station -> CodeButton : codeSendComplete()
activate CodeButton
CodeButton ->o Layout : Code Indicator\nOFF
deactivate CodeButton
Station -> TurnoutSection : codeValueDelivered()
activate TurnoutSection
TurnoutSection ->o Layout : Set Turnout
deactivate TurnoutSection
Station -> CodeButton : codeSendComplete()
activate CodeButton
CodeButton ->o Layout : Code Indicator\nOFF
deactivate CodeButton
deactivate CodeLine
deactivate Station

note over Station: Wait for remote\noperation to complete\ne.g. turnout to move\nMaybe in CodeLine?

note over Station: From here down, this is a receipt of a indication from the remote station - same as other diagram - make sure consistent!

Layout -> Station : timeout
activate Station
Station -> TurnoutSection : indicationStart()
activate TurnoutSection
note over TurnoutSection : Query layout turnout
deactivate TurnoutSection
Station -> CodeLine : requestIndicationStart()
activate CodeLine
CodeLine -> CodeButton : indicationStart()
activate CodeButton
CodeButton ->o Layout : Code Indicator\nON
deactivate CodeButton
CodeLine ->o Layout : Indication sequence\nSTART
deactivate CodeLine
deactivate Station

...

Layout o-> CodeLine: Indication sequence\nCOMPLETE
activate CodeLine
CodeLine -> CodeButton : indicationComplete()
activate CodeButton
CodeButton ->o Layout : Code Indicator\nOFF
deactivate CodeButton
CodeLine -> Station : indicationComplete()

Station -> TurnoutSection : indicationComplete()
activate TurnoutSection
TurnoutSection ->o Layout : TO Indicators\nSET
deactivate TurnoutSection

deactivate CodeLine


@enduml

